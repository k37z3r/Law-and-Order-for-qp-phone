--[[
 .----------------. .----------------. .----------------.
| .--------------. | .--------------. | .--------------. |
| |   ______     | | |      __      | | |     ____     | |
| |  |_   _ \    | | |     /  \     | | |   .'    `.   | |
| |    | |_) |   | | |    / /\ \    | | |  /  .--.  \  | |
| |    |  __'.   | | |   / ____ \   | | |  | |    | |  | |
| |   _| |__) |  | | | _/ /    \ \_ | | |  \  `--'  /  | |
| |  |_______/   | | ||____|  |____|| | |   `.____.'   | |
| |              | | |              | | |              | |
| '--------------' | '--------------' | '--------------' |
 '----------------' '----------------' '----------------'

Â© Copyright 2022 all rights reserved

All contents, especially the source code of all files, are protected by copyright. All rights, including reproduction, publication, editing and translation, are reserved.
A legal version for use can be purchased at https://bao.tebex.io/
]]--
local a=exports['qb-core']:GetCoreObject()a.Functions.CreateCallback('qb-phone:server:GetLawAndOrder',function(b,c)local d=MySQL.query.await('SELECT * FROM lawandorder WHERE 1 ORDER BY lawandorder.para ASC')if d[0]~=nil then for e,f in pairs(d)do d[#d+1]={lawid=d[0],category=d[1],para=d[2],legaltitle=d[3],legaltext=d[4],minsentence=d[5],maxsentence=d[6]}end end;c(d)end)a.Functions.CreateCallback('qb-phone:server:isAdmin',function(b,g)if a.Functions.HasPermission(b,'god')or IsPlayerAceAllowed(b,'command')then g(true)else g(false)end end)function explode(h,i)if i==nil then i="%s"end;local t={}for j in string.gmatch(h,"([^"..i.."]+)")do table.insert(t,j)end;return t end;a.Functions.CreateCallback('qb-phone:server:getLawCategories',function(b,c)local k=MySQL.query.await("SELECT COLUMN_TYPE FROM information_schema.COLUMNS WHERE TABLE_NAME='lawandorder' AND COLUMN_NAME='category'")text=string.gsub(k[1]['COLUMN_TYPE'],"enum%(","")text=string.gsub(text,"%)","")text=string.gsub(text,"\'","")finish=explode(text,",")c(finish)end)a.Functions.CreateCallback('qb-phone:server:saveLawAndOrder',function(b,c,l)local m=b;local n=a.Functions.GetPlayer(m)local o=n.PlayerData.citizenid;local p=n.PlayerData.name;local d=MySQL.query.await('SELECT * FROM lawandorder WHERE 1 ORDER BY lawandorder.para ASC')counting=0;if d~=nil then for f in pairs(d)do counting=counting+1 end end;if a.Functions.HasPermission(m,'god')or IsPlayerAceAllowed(m,'command')then if l~=nil then if l.category~=nil and l.category~=nil and l.para~=nil and l.legaltitle~=nil and l.legaltext~=nil and l.minsentence~=nil and l.maxsentence~=nil and l.lawid~=nil then if string.len(l.category)>2 and string.len(l.para)>0 and string.len(l.legaltitle)>2 and string.len(l.legaltext)>9 and string.len(l.minsentence)>1 and string.len(l.maxsentence)>1 and string.len(l.lawid)>0 then if not l.doEdit then if counting<511 then MySQL.insert.await('INSERT INTO lawandorder (`category`, `para`, `legaltitle`, `legaltext`, `minsentence`, `maxsentence`) VALUES (?, ?, ?, ?, ?, ?)',{l.category,l.para,l.legaltitle,l.legaltext,l.minsentence,l.maxsentence})else c("not-ok")print("The maximum number of laws has been reached. Security settings were bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else MySQL.update.await('UPDATE lawandorder SET category = ?, para = ?, legaltitle = ?, legaltext = ?, minsentence = ?, maxsentence = ? WHERE lawid = ? LIMIT 1',{l.category,l.para,l.legaltitle,l.legaltext,l.minsentence,l.maxsentence,l.lawid})end;c("ok")else c("not-ok")print("One input field was too short. Security settings were bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("One input field was nil. Security settings were bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("No JSON data available. Security settings have been bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("Unauthorized access. Security settings have been bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end end)function setsinglepquotas(h,i)h=string.gsub(h,"%p","")h=string.gsub(h,"%c","")h=string.gsub(h,"%z","")h=string.gsub(h,"%s+"," ")if i==nil then i="%s"end;local t={}for j in string.gmatch(h,"([^"..i.."]+)")do table.insert(t,"'"..j.."'")end;return t end;a.Functions.CreateCallback('qb-phone:server:saveLawAndOrderCats',function(b,c,l)local m=b;local n=a.Functions.GetPlayer(m)local o=n.PlayerData.citizenid;local p=n.PlayerData.name;if a.Functions.HasPermission(m,'god')or IsPlayerAceAllowed(m,'command')then if l~=nil then if l.categories~=nil then if string.len(l.categories)>2 then t=setsinglepquotas(l.categories," ")t=table.concat(t,",")MySQL.update.await('ALTER TABLE lawandorder CHANGE category category ENUM( '..t..' ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;',{})finish=explode(text,",")explode(l.categories,",")c("ok")else c("not-ok")print("One input field was too short. Security settings were bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("One input field was nil. Security settings were bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("No JSON data available. Security settings have been bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("Unauthorized access. Security settings have been bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end end)a.Functions.CreateCallback('qb-phone:server:deleteLawAndOrder',function(b,c,l)local m=b;local n=a.Functions.GetPlayer(m)local o=n.PlayerData.citizenid;local p=n.PlayerData.name;if a.Functions.HasPermission(m,'god')or IsPlayerAceAllowed(m,'command')then if l~=nil then if l.lawid~=nil then if string.len(l.lawid)>0 then MySQL.update.await('DELETE FROM lawandorder WHERE lawid = ? LIMIT 1',{l.lawid})c("ok")else c("not-ok")print("One input field was too short. Security settings were bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("One input field was nil. Security settings were bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("No JSON data available. Security settings have been bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end else c("not-ok")print("Unauthorized access. Security settings have been bypassed!")print("CitizenID: "..o)print("Name: "..p.." aka "..n.PlayerData.charinfo.firstname.." "..n.PlayerData.charinfo.lastname)end end)